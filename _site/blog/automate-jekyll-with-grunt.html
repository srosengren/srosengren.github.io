<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Rosengren.me - Automate and livereload a jekyll site with less using grunt</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content=" I'm one of those guys that code thingamajigs, sometimes for mobile devices, but mostly for the web using Javascript and css/less. ">

        <meta property="og:type" content="website"/>
        <meta property="og:image" content="http://www.rosengren.me/assets/images/badge.jpg" />
        <meta property="og:description" content=" I'm one of those guys that code thingamajigs, sometimes for mobile devices, but mostly for the web using Javascript and css/less. "/>

        <!--[if lt IE 9]>
           <script>
              document.createElement('nav');
              document.createElement('header');
              document.createElement('section');
              document.createElement('footer');
              document.createElement('article');
              document.createElement('time');
           </script>
        <![endif]-->
        <link rel="stylesheet" href="/assets/styles/rosengren.css">

    </head>
    <body>
      <div class="navbar-menu-toggle" id="menu-toggle">Menu</div>
      <div class="page" id="page">
        <nav class="navbar" id="navbar-menu">
          <div class="navbar-menu collapse">
            <a class="navbar-menu-item navbar-menu-title navbar-menu-item--home" href="/">home</a>
            <a class="navbar-menu-item navbar-menu-item--blog" href="/blog">blog</a>
          </div>
          <span class="navbar-menu navbar-menu-contact collapse">
            <a class="navbar-menu-item navbar-menu-item--linkedin" href="http://www.linkedin.com/in/srosengren" target="_blank">LinkedIn</a>
            <a class="navbar-menu-item navbar-menu-item--twitter" href="https://twitter.com/srrosengren" target="_blank">Twitter</a>
            <a class="navbar-menu-item navbar-menu-item--github" href="https://github.com/srosengren" target="_blank">Github</a>
            <a class="navbar-menu-item navbar-menu-item--mail" href="javascript:;" id="mail-link">Mail</a>
          </span>
        </nav>
        <div class="main-content" id="content">
            <article class="post">
	<header>
		<h1 class="post__title">Automate and livereload a jekyll site with less using grunt</h1>
		<div class="post__byline">
			<time datetime="2013-12-20 16:25:00 +0100">20 Dec 2013</time>
			web, javascript, frontend, jekyll, gruntjs, less, and development
		</div>
	</header>
	<div class="post__content"><p>I’ll be the first to admit it, my “workflow” is/was really ancient, my professional work is to 99% done in Visual Studio which has made me a bit spoiled since it handles almost anything you want it to do.
Work that I do for fun on the other hand is mostly written with sublime text. This site for instance is built with jekyll and I use LESS as a preprocessor for its stylesheets.</p>

<p>My old workflow for developing/writing posts for this site was pretty much non-existant. I used Winless for compilling LESS and it has the occasional hiccups where it wouldn’t listen to updates in imported files and recompile my main LESS file. I also ran <code>jekyll build</code> manually from a bash prompt. The Winless issue meant that I sometimes had to compile jekyll, realize that the LESS file wasn’t compiled and thus not updated in the new build so I had to manually compile LESS and then build jekyll again, a time consuming and headache inducing experience I can assure you.</p>

<p>I’ve been interested in GruntJS for a while now but I didn’t realize that I could use it to solve my issue before reading Chris Coyiers <a href="http://24ways.org/2013/grunt-is-not-weird-and-hard/">article</a>, I also feared that it would be hard since it runs on node. Turns out that setting up grunt on windows was a breeze and that creating a grunt file for this project wasn’t to hard, mainly because a lot of people has written about parts of what I tried to achieve. Chris’s article covered most of it but I also had to find some posts about jekyll and grunt, and then merge this information.</p>

<p>I will try to make an abridged version of the information that I’ve compiled, referring back to the original content but also write my conclusions in case the original posts disappears.</p>

<h2 id="setting-it-up">Setting it up</h2>

<p><a href="http://24ways.org/2013/grunt-is-not-weird-and-hard/">Chris Coyier</a> writes about the basics of setting up grunt, all you have to do is go to <a href="http://nodejs.org/">http://nodejs.org/</a> and click the install button. You then create a file called “package.json” in your sites root folder with the following:</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;My jekyll site&quot;</span><span class="p">,</span>
  <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
  <span class="s2">&quot;devDependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;grunt&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.4.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grunt-contrib-less&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.8.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grunt-contrib-watch&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.5.3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grunt-contrib-copy&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.4.1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;grunt-shell&quot;</span><span class="o">:</span> <span class="s2">&quot;~0.6.1&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>And then run <code>npm install</code> in your console of choice (I use the git bash) while “standing” in your site root folder e.g, <code>cd c:\myfolder</code> in cmd or <code>cd /c/myfolder</code> in the git bash to install your dependencies. UPDATE: I’ve had this step fail for me with the error <code>Error: ENOENT, stat c:\users\username\AppData\Roaming\npm</code>, I solved this by copying the <code>npm</code> file from my node js installation, in my case this was <code>C:\Program Files\nodejs</code> into my roaming folder.</p>

<p>We must now install the Grunt CLI, this is what makes the grunt command that we will run later work. We do this by executing <code>npm install -g grunt-cli</code> in the console. UPDATE: My “copying npm file” fix seems to be causing issues with this, remove the npm file again since this command wants to create a directory called npm.</p>

<p>Now it’s time to write our gruntfile that will compile less and build jekyll, it should of course do this without us having to press reload in our browser.</p>

<p>We will begin with this small gruntfile that compiles our less on the fly, we don’t have to install livereload on our machines since this is built into <code>grunt-contrib-watch</code>, but we still have to install a <a href="http://feedback.livereload.com/knowledgebase/articles/86242-how-do-i-install-and-use-the-browser-extensions-">browser plugin</a></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-less&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-watch&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
    <span class="nx">less</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">development</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">paths</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;./assets/styles/less&quot;</span><span class="p">],</span>
          <span class="nx">yuicompress</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="nx">compress</span><span class="o">:</span> <span class="kc">true</span>
        <span class="p">},</span>
        <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
          <span class="s1">&#39;./assets/styles/rosengren.css&#39;</span><span class="o">:</span> <span class="s1">&#39;./assets/styles/rosengren.less&#39;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">less</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">files</span><span class="o">:</span> <span class="s1">&#39;./assets/styles/*.less&#39;</span><span class="p">,</span>
      <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;less:development&#39;</span><span class="p">],</span>
      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">spawn</span><span class="o">:</span> <span class="kc">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;watch&#39;</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>What this does is that it listens to changes in any LESS file in my /assets/styles folder. It compiles and minifies <code>rosengren.less</code> to <code>rosengren.css</code> by running the <code>less:development</code> task from the <code>watch:less</code> task when it detects an update. It also notifies livereload in any browser and injects the new CSS without refreshing the page.</p>

<p>Now is a good time to execute <code>grunt</code> in the console and make sure that everything is working so far. the console should answer with `Running “watch” task, Waiting. Make a change in one of your less files and the console window will come to life and tell you what it’s doing.</p>

<p>I found a post by <a href="http://thanpol.as/jekyll/jekyll-and-livereload-flow/">Thanasis Polychronakis</a> That describes how to get grunt to build jekyll through a shell task. And also added that we should have an additional task that copies compiled less directly to our _site folder without having to build jekyll since it takes a lot of time.</p>

<p>We do this by adding these tasks directly into the <code>grunt.initConfig</code> parameter object, they should be added right next to the <code>less</code> and <code>watch</code> tasks.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">copy</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">css</span> <span class="o">:</span> <span class="p">{</span>
    <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;./_site/assets/styles/rosengren.css&#39;</span><span class="o">:</span> <span class="s1">&#39;./assets/styles/rosengren.css&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">},</span>
<span class="nx">shell</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">jekyll</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">stdout</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">},</span>
    <span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;jekyll build&#39;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>We should also add <code>'copy:css'</code> into the <code>watch:less</code> tasks array. and a secondary watch task that should be added next to the <code>watch:less</code> task</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">jekyll</span><span class="o">:</span> <span class="p">{</span>
  <span class="nx">files</span><span class="o">:</span> <span class="p">[</span>
    <span class="s1">&#39;*.html&#39;</span><span class="p">,</span> <span class="s1">&#39;*.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;assets/js/**.js&#39;</span><span class="p">,</span>
    <span class="s1">&#39;_posts/**&#39;</span><span class="p">,</span> <span class="s1">&#39;_includes/**&#39;</span>
  <span class="p">],</span>
  <span class="nx">tasks</span><span class="o">:</span> <span class="s1">&#39;shell:jekyll&#39;</span><span class="p">,</span>
  <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>We also have to tell grunt to load additional tasks for our config file to make sense.</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript">  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-copy&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-shell&#39;</span><span class="p">);</span></code></pre></figure>

<p>The <code>copy</code> task copies the <code>rosengren.css</code> file into our _site folder, this will be run when our <code>watch:less</code> detects a change since we added the task into the tasks array and it will be included in the livereload.</p>

<p>The new <code>watch:jekyll</code> task will listen to any change in files that should trigger a jekyll build, it will then trigger the <code>shell:jekyll</code> task and a livereload after it has finished.</p>

<p>The new tasks that we’re loading should be added within the main function of the file, next to the previously loaded tasks.</p>

<h2 id="finally">Finally</h2>

<p>Well there you have it, a jekyll site that builds when files are updated and compiles and injects LESS when it detects any change in a LESS file.</p>

<p>The grunt file for this site as of writing can be found <a href="https://github.com/srosengren/srosengren.github.io/blob/bf3f4c50a3ccd853871fea8461128227887a933b/_site/gruntfile.js">here </a></p>
</div>
</article>

<section>


    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                
                <h4>Similar Posts</h4>
                <ul>
                
                <li>
                    <a href="/blog/validate-authorization-policy-mvc6-vnext-aspnet5">Validate authorization policy in MVC6 vnext, asp.net5
                    
                    </a>
                </li>
                
                
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/global-authorization-attribute-filter-mvc6-vnext-aspnet5">Global Authorization attribute filter in MVC6 vnext, asp.net5
                    
                    </a>
                </li>
                
                
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/how-to-avoid-committing-secret-application-settings-visualstudio-github-azure">How to avoid committing secret application settings when working with visual studio, github and azure
                    
                    </a>
                </li>
                
                
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/custom-cultures-multi-tenant-translations-dotnet">Custom cultures and multi-tenant localizations in .net
                    
                    </a>
                </li>
                
                
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
                
                <li>
                    <a href="/blog/javascript-objects-are-hashmaps-cloning-merging">Javascript objects are hashmaps, how to clone and/or merge them
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
                
                <li>
                    <a href="/blog/augmentation-factory-pattern">Augmentation factory pattern
                    
                    </a>
                </li>
                
                
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    


    </ul>

</section>
        </div>
        <footer class="footer-content">
          Powered by <a href="http://http://jekyllrb.com/" target="_blank">Jekyll</a>, hosted on <a href="https://github.com/" target="_blank">Github</a>, compiled using <a href="http://www.ruby-lang.org/en/" target="_blank">Ruby</a> and <a href="http://http://python.org/" target="_blank">Python</a> by a <a href="http://www.microsoft.com/net" target="_blank">.NET</a> guy.
        </footer>
      </div>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-41772613-1', 'rosengren.me');
        ga('send', 'pageview');

        document.getElementById('mail-link').href = 'mailto:' + 'sebastian' + '@' + 'rosengren' + '.me';

        document.getElementById('menu-toggle').addEventListener('click', function(){
          var navbar = document.getElementById('page');
          if(navbar.className.indexOf('drawer--open') > -1){
            navbar.className = navbar.className.replace(' drawer--open','');
          } else {
            navbar.className = navbar.className + ' drawer--open';
          }
        });

        document.getElementById('content').addEventListener('click',function(){
          var navbar = document.getElementById('page');
          if(navbar.className.indexOf('drawer--open') > -1){
            navbar.className = navbar.className.replace(' drawer--open','');
          }
        })
      </script>
    </body>
</html>
