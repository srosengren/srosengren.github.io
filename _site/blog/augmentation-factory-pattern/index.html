<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Rosengren.me - Augmentation factory pattern</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="The augmentation factory pattern is an extension of the normal factory pattern when working with dynamic languages. It can be thought of as a way to get interfaces into javascript, or a way to deal with inheritance without using any actual inheritance. I do not find it helpful when working with class based languages but I do use it extensively when writing javascript.

">

        <meta property="og:type" content="article"/>
        <meta property="og:image" content="http://www.rosengren.me/assets/images/badge.jpg" />
        <meta property="og:description" content="The augmentation factory pattern is an extension of the normal factory pattern when working with dynamic languages. It can be thought of as a way to get interfaces into javascript, or a way to deal with inheritance without using any actual inheritance. I do not find it helpful when working with class based languages but I do use it extensively when writing javascript.

"/>

        <!--[if lt IE 9]>
           <script>
              document.createElement('nav');
              document.createElement('header');
              document.createElement('section');
              document.createElement('footer');
              document.createElement('article');
              document.createElement('time');
           </script>
        <![endif]-->
        <link rel="stylesheet" href="/assets/styles/rosengren.css">

    </head>
    <body>
      <div class="navbar-menu-toggle" id="menu-toggle">Menu</div>
      <div class="page" id="page">
        <nav class="navbar" id="navbar-menu">
          <div class="navbar-menu collapse">
            <a class="navbar-menu-item navbar-menu-title navbar-menu-item--home" href="/">home</a>
            <a class="navbar-menu-item navbar-menu-item--blog" href="/blog">blog</a>
          </div>
          <span class="navbar-menu navbar-menu-contact collapse">
            <a class="navbar-menu-item navbar-menu-item--linkedin" href="http://www.linkedin.com/in/srosengren" target="_blank">LinkedIn</a>
            <a class="navbar-menu-item navbar-menu-item--twitter" href="https://twitter.com/srrosengren" target="_blank">Twitter</a>
            <a class="navbar-menu-item navbar-menu-item--github" href="https://github.com/srosengren" target="_blank">Github</a>
            <a class="navbar-menu-item navbar-menu-item--mail" href="javascript:;" id="mail-link">Mail</a>
          </span>
        </nav>
        <div class="main-content" id="content">
            <article class="post">
	<header>
		<h1 class="post__title">Augmentation factory pattern</h1>
		<div class="post__byline">
			<time datetime="2014-09-02 12:50:00 +0200">02 Sep 2014</time>
			patterns, factory, javascript, and c#
		</div>
	</header>
	<div class="post__content"><p>The augmentation factory pattern is an extension of the normal factory pattern when working with dynamic languages. It can be thought of as a way to get interfaces into javascript, or a way to deal with inheritance without using any actual inheritance. I do not find it helpful when working with class based languages but I do use it extensively when writing javascript.</p>

<h3 id="normal-factory-pattern">Normal factory pattern</h3>
<p>I’m a big fan of the factory method pattern and I use it a lot when writing c# code. I find that it helps me with Interface based architectures as I can move logic for the creation of objects out of constructors and into a method that can be used to instantiate different implementations of a specific interface, without them having to share a base class, which I find is good for code reuse in most cases.</p>

<h4 id="the-most-basic-example">The most basic example</h4>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">Car</span>
<span class="p">{</span>
  <span class="k">public</span> <span class="kt">string</span> <span class="n">Manufacturer</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

  <span class="c1">//Factory method</span>
  <span class="k">public</span> <span class="k">static</span> <span class="n">Car</span> <span class="nf">Make</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Car</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="n">Car</span> <span class="n">c</span> <span class="p">=</span> <span class="n">Car</span><span class="p">.</span><span class="n">Make</span><span class="p">();</span></code></pre></div>

<p><a href="http://en.wikipedia.org/wiki/Factory_method_pattern">Wikipedia</a> has a more extensive explanation of the factory pattern with code examples for java,php and c#.</p>

<h3 id="augmentation-factory-pattern">Augmentation factory pattern</h3>
<p>What I use the augmentation factory pattern for mostly is to fake interfaces/multiple inheritance into javascript. </p>

<h4 id="a-basic-example">A basic example</h4>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">phoneAble</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">make</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">){</span>
    <span class="nx">objectToAugment</span> <span class="o">=</span> <span class="nx">objectToAugment</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">call</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">phoneNumber</span><span class="p">){</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;calling &#39;</span> <span class="o">+</span> <span class="nx">phoneNumber</span> <span class="o">+</span> <span class="s1">&#39; from &#39;</span> <span class="o">+</span> <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">objectToAugment</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">//Create a new phoneable object</span>
<span class="kd">var</span> <span class="nx">myPhoneableObject</span> <span class="o">=</span> <span class="nx">phoneAble</span><span class="p">.</span><span class="nx">make</span><span class="p">();</span>

<span class="c1">//Make an existing object phoneable</span>
<span class="kd">var</span> <span class="nx">myExistingObject</span> <span class="o">=</span> <span class="p">{</span>
	<span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;test&#39;</span>
<span class="p">};</span>
<span class="nx">phoneAble</span><span class="p">.</span><span class="nx">make</span><span class="p">(</span><span class="nx">myExistingObject</span><span class="p">);</span></code></pre></div>

<p>In this example I’ve created a factory called <code>phoneAble</code> that can either work like a normal factory method by calling it without any argument, or as a augmentation factory by calling it with an existing object as a single argument. What’s important here is the first line of the factory <code>objectToAugment = objectToAugment || {}</code> that makes sure that we always have a object to work on and return from the factory. Calling at as a augmentation factory will modify the existing object and because of that we won’t have to assign it to a variable since we already have a reference.</p>

<h4 id="extendability-interfacemulti-inheritance">Extendability (interface/multi inheritance)</h4>
<p>We can now create other factories that internally uses our phoneAble factory.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">company</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">make</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">){</span>
    <span class="nx">objectToAugment</span> <span class="o">=</span> <span class="nx">objectToAugment</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">phoneAble</span><span class="p">.</span><span class="nx">make</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">);</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span> <span class="o">=</span> <span class="mi">321</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">objectToAugment</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">make</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">){</span>
    <span class="nx">objectToAugment</span> <span class="o">=</span> <span class="nx">objectToAugment</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="nx">phoneAble</span><span class="p">.</span><span class="nx">make</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">);</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
    
    <span class="k">return</span> <span class="nx">objectToAugment</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></div>

<p>We might say that objects created by these factories also “implements” phoneAble. We can argue that this example could be implemented through regular inheritance via prototyping. But phoneAble is not what I would call a “baseclass” since it’s just a functionality container, and it might be one of many that we would like to apply to objects from a certain factory (type). This to could be solved by creating a intricate system of inheritance where each level provided the requested functionality, but this isn’t feasible in a large scale application to me as my experience tells me that it takes a lot of effort both to maintain and to add new types.</p>

<h4 id="collisions">Collisions?</h4>
<p>This is a issue that might present itself in a larger application with several chained factories. We will eventually have factories that augment with the same members. This isn’t much of an issue for simple properties as this can be solved like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">phoneAble</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">make</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">){</span>
    <span class="nx">objectToAugment</span> <span class="o">=</span> <span class="nx">objectToAugment</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="c1">//Make sure that we don&#39;t override existing properties</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span> <span class="o">=</span> <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">phoneNumber</span> <span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">objectToAugment</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></div>

<p>But it might prove a real issue with functions as each factory expects the methods that it calls to be the implementation that it chose. There is no solution for this for public methods, but neither is there in c# as you can only have one implementation for each member name. What we can do is make sure that only public methods are augmented on to the object and keep the rest private in the factory closure.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">phoneAble</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">make</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objectToAugment</span><span class="p">){</span>
    <span class="nx">objectToAugment</span> <span class="o">=</span> <span class="nx">objectToAugment</span> <span class="o">||</span> <span class="p">{};</span>
	  
    <span class="kd">var</span> <span class="nx">privateFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){};</span>
    <span class="nx">objectToAugment</span><span class="p">.</span><span class="nx">publicFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
    	<span class="c1">//call private method</span>
    	<span class="nx">privateFunction</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">objectToAugment</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span></code></pre></div>

<h3 id="conclusion">Conclusion</h3>
<p>I use this pattern most of the time when I write javascript, it helps me avoid moving logic into constructors functions and adds to code reuse as I can build reusable code components (implemented interfaces). These are my experiences with it and your mileage may vary.</p>
</div>
</article>

<section>


    
    
        
            
        
            
        
            
                
                <h4>Similar Posts</h4>
                <ul>
                
                <li>
                    <a href="/blog/javascript-objects-are-hashmaps-cloning-merging">Javascript objects are hashmaps, how to clone and/or merge them
                    
                    </a>
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/compact-datatransfer-experiment">Compact datatransfer experiment
                    
                    </a>
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/json-net-is-awesome">Json.NET is awesome
                    
                    </a>
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/automate-jekyll-with-grunt">Automate and livereload a jekyll site with less using grunt
                    
                    </a>
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    

    
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
                
                <li>
                    <a href="/blog/jquery-data-and-html-data-attributes">Relationship of jQuery data and data- html attributes
                    
                    </a>
                </li>
                
                
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    
        
            
        
            
        
            
        
            
        
    


    </ul>

</section>
        </div>
        <footer class="footer-content">
          Powered by <a href="http://http://jekyllrb.com/" target="_blank">Jekyll</a>, hosted on <a href="https://github.com/" target="_blank">Github</a>, compiled using <a href="http://www.ruby-lang.org/en/" target="_blank">Ruby</a> and <a href="http://http://python.org/" target="_blank">Python</a> by a <a href="http://www.microsoft.com/net" target="_blank">.NET</a> guy.
        </footer>
      </div>
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-41772613-1', 'rosengren.me');
        ga('send', 'pageview');

        document.getElementById('mail-link').href = 'mailto:' + 'sebastian' + '@' + 'rosengren' + '.me';

        document.getElementById('menu-toggle').addEventListener('click', function(){
          var navbar = document.getElementById('page');
          if(navbar.className.indexOf('drawer--open') > -1){
            navbar.className = navbar.className.replace(' drawer--open','');
          } else {
            navbar.className = navbar.className + ' drawer--open';
          }
        });

        document.getElementById('content').addEventListener('click',function(){
          var navbar = document.getElementById('page');
          if(navbar.className.indexOf('drawer--open') > -1){
            navbar.className = navbar.className.replace(' drawer--open','');
          }
        })
      </script>
    </body>
</html>
